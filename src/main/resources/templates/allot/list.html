<!DOCTYPE html><html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"><head th:include="head::head(${title})"></head><link th:href="@{/assets/css/select/bootstrap-select.min.css}" rel="stylesheet" media="screen"><script th:src="@{/assets/js/select/bootstrap-select.js}"></script><script th:src="@{/assets/js/select/defaults-zh_CN.js}"></script><body><div th:replace="navbar::navbar"></div><div class="main-container" id="main-container">    <div class="breadcrumbs" id="breadcrumbs">        <ul class="breadcrumb">            <li>                <i class="icon-home home-icon"></i>                首页            </li>            <li>                <i class="icon-table home-icon"></i>                移库单            </li>        </ul>    </div>    <div style="margin-top: 4px;margin-bottom: 4px">        <div class="col-sm-3">            <button class="btn btn-sm btn-primary" onclick="toAdd()">                <i class="icon-plus align-top bigger-125"></i>                添加移库单            </button>            <button class="btn btn-sm btn-danger" onclick="doDel()">                <i class="icon-trash align-top bigger-125"></i>                删除移库单            </button>        </div>    </div>    <div class="col-sm-8">        <div class="col-sm-3">            <div class="input-group">                <span class="input-group-addon">移库单号:</span>                <input id="billcode" name="billcode" type="text" class="form-control">            </div>        </div>        <div class="col-sm-3">            <div class="input-group">                <span class="input-group-addon">移库类型:</span>                <!--<input id="billkind" name="billkind" type="text" class="form-control">-->                <select id="billkind" name="billkind" class="form-control">                </select>            </div>        </div>        <div class="col-sm-4">            <button class="btn btn-sm btn-success" onclick="searchTable()">                <i class="icon-search align-top bigger-125"></i>                查询            </button>            <button class="btn btn-sm btn-warning" onclick="rest()">                <i class="icon-undo align-top bigger-125"></i>                重置            </button>        </div>    </div>    <div class="table-responsive" style="width:100%">        <table id="myTable" style="width:100%" class="table table-striped table-bordered table-hover">            <thead>            <tr>                <th class="center" style="width: 2%"></th>                <th class="center" style="width: 2%">                    <label>                        <input id="CK" type="checkbox" class="ace"/>                        <span class="lbl"></span>                    </label>                </th>                <th style="width: 10%">单据号</th>                <th style="width: 10%">单据状态</th>                <th style="width: 10%">移库类型</th>                <th style="width: 10%">调出粮仓</th>                <th style="width: 10%">调入粮仓</th>                <th style="width: 10%">实际数量</th>                <th style="width: 10%">操作</th>            </tr>            </thead>        </table>    </div>    <a href="#" id="btn-scroll-up" class="btn-scroll-up btn btn-sm btn-inverse">        <i class="icon-double-angle-up icon-only bigger-110"></i>    </a></div></body></html><script th:inline="javascript">    var urlPrefix = "/graindepot-bussiness";    //var urlPrefix = "";    var theTable;    function selectOnchang(o) {        //获取全部打钩的check的值        //$('#myTable th input:checkbox:checked')        console.log($('#myTable').bootstrapTable("getChecked"))    }    $(document).ready(function () {        query();        initBillKind();    });    //查询列表    function query(param) {        theTable = $('#myTable').bootstrapTable({            //数据来源（包括处理分页，排序，过滤） ，即url，action，接口，等等            ajax: {                url: urlPrefix + "/allot/list/page",                data: param,                type: "GET"            },            //sScrollY: 510,//表格高度            columns: [                {title: "单据号", data: "billcode"},                {                    title: "移库类型",                    data: "billkind",                    render: function (data, type, row) {                        if (data == 1) {                            // console.log("data...",data);                            return "单据移库"                        } else if (data == 2) {                            return "检斤移库"                        }                    }                },                {title: "调出粮仓", data: "outstoragename"},                {title: "调入粮仓", data: "instoragename"},                {title: "实际数量", data: "facqty"},                {                    title: "单据状态",                    data: "billstate",                    render: function (data, type, row) {                        if (data == 0) {                            // console.log("data...",data);                            return "编辑"                        } else if (data == 1) {                            return "已审核"                        } else if (data == -1) {                            return "已作废"                        }                    }                },                {                    data: "billid",                    render: function (data, type, row) {                        return '<div class="visible-md visible-lg hidden-sm hidden-xs action-buttons">' +                            '<a class="green" href="javascript:toEdit(' + data + ')"' +                            ' title="编辑" ' +                            '>' +                            '<i class="icon-pencil bigger-130"></i>' +                            '</a>' +                            '<a class="blue" href="javascript:toDetail(' + data + ')"' +                            'title="详情"' +                            '>' +                            '<i class="icon-eye-open bigger-130"></i>' +                            '</a>' +                            '</div>';                    }                }            ]        });    }    function initBillKind() {        var data = [{value: 1, text: "单据移库"}, {value: 2, text: "检斤移库"}];        $("#billkind").bootstrapSelect({            //url: '/tableListPost',            // type: 'POST',            data: data,            valueField: 'value',            textField: 'text',        });    }    function searchTable() {        theTable.destroy();        query(getParam());    }    function getParam() {        var param = {};        param.billcode = $("#billcode").val();        param.billkind = $("#billkind").val();        return param    }    function rest() {        $("input").val("");        $("select").val("");        //触发change事件        $("select").trigger("change");        searchTable();        //$("#city").find("option[value = '"+"']").attr("selected","selected");//jq改变select的选中值    }    function doDel() {        console.log($('#myTable').bootstrapTable("getChecked"));        var checkedList = $('#myTable').bootstrapTable("getChecked");        if (checkedList.length == 0) {            $.bootstrapBox.alert.init({message: "请选择需要删除的行"});            return        }        $.bootstrapBox.confirm.init({            message: "确认删除？",            callback: function (result) {                if (result) {                    //删除用户                    var ids = checkedList.map(function (curr) {                        return curr.billid                    });                    $.post(urlPrefix + "/allot/del", {ids: ids.join(",")}, function (result) {                        $.bootstrapBox.alert.init({                            message: result.message                        });                        $("#myTable").bootstrapTable("reload");                    })                }            }        });    }    function toAdd() {        $.bootstrapBox.dialog.init({            title: "新增移库单",            url: urlPrefix + "/page/allot/edit",            width: $(window).width() * 0.8,            height: $(window).height() * 0.8        })    }    function toEdit(id) {        $.bootstrapBox.dialog.init({            title: "修改移库单",            url: urlPrefix + "/page/allot/edit?id=" + id,            width: $(window).width() * 0.8,            height: $(window).height() * 0.8        })    }    function toDetail(id) {        $.bootstrapBox.dialog.init({            title: "移库单详情",            url: urlPrefix + "/page/allot/detail/" + id,            width: $(window).width() * 0.8,            height: $(window).height() * 1.0        })    }    function toSave(result) {        $.bootstrapBox.dialog.close();        $.bootstrapBox.alert.init({            message: result.message        });        $("#myTable").bootstrapTable("reload")    }</script>