<!DOCTYPE html><html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"><head th:replace="head::head(${title})"></head><link th:href="@{/assets/css/select/bootstrap-select.min.css}" rel="stylesheet" media="screen"><script th:src="@{/assets/js/select/bootstrap-select.js}"></script><script th:src="@{/assets/js/select/defaults-zh_CN.js}"></script><link th:href="@{/assets/js/uploadify/uploadify.css}" rel="stylesheet" type="text/css"><script th:src="@{/assets/js/uploadify/jquery.uploadify.js}"></script><body style="overflow-x: hidden"><form class="form-horizontal" role="form" id="validation-form" method="get">    <div class="controls controls-row">        <div class="form-group">            <label class="col-sm-1 control-label no-padding-right" for="truckid">                <span class="red">*</span>车船号:            </label>            <div class="col-sm-3">                <select id="truckid" name="truckid" class="form-control"                        data-bv-notempty th:value="${item.truckid}">                </select>            </div>            <label class="col-sm-1 control-label no-padding-right" for="billkind">                <span class="red">*</span>移库类型:            </label>            <div class="col-sm-3">                <select id="billkind" name="billkind" class="form-control"                        data-bv-notempty th:value="${item.billkind}">                </select>            </div>            <label class="col-sm-1 control-label no-padding-right" for="billstate">                单据状态:            </label>            <div class="col-sm-3">                <select id="billstate" name="billstate" class="form-control"                        th:value="${item.billstate}">                </select>            </div>        </div>    </div>    <div class="form-group">        <div class="form-inline">            <label class="col-sm-1 control-label no-padding-right" for="outstorageid">                <span class="red">*</span>调出粮仓:            </label>            <div class="col-sm-3">                <select id="outstorageid" name="outstorageid" class="form-control"                        data-bv-notempty th:value="${item.outstorageid}">                </select>            </div>        </div>        <div class="form-inline">            <label class="col-sm-1 control-label no-padding-right" for="instorageid">                <span class="red">*</span>调入粮仓:            </label>            <div class="col-sm-3">                <select id="instorageid" name="instorageid" class="form-control"                        data-bv-notempty th:value="${item.instorageid}">                </select>            </div>        </div>        <div class="form-inline">            <label class="col-sm-1 control-label no-padding-right" for="grainid">                <span class="red">*</span>粮食品种:            </label>            <div class="col-sm-3">                <select id="grainid" name="grainid" class="form-control"                        data-bv-notempty th:value="${item.grainid}">                </select>            </div>        </div>    </div>    </div>    <div class="controls controls-row">        <div class="form-group">            <label class="col-sm-1 control-label no-padding-right" for="grainattrid">                <span class="red">*</span>粮食性质:            </label>            <div class="col-sm-3">                <select id="grainattrid" name="grainattrid" class="form-control"                        data-bv-notempty th:value="${item.grainattrid}">                </select>            </div>            <label class="col-sm-1 control-label no-padding-right" for="producingyear">                <span class="red">*</span>收获年度:            </label>            <div class="col-sm-3">                <input size="16" type="text" name="producingyear" id="producingyear"                       data-bv-notempty th:value="${item.producingyear}"                       readonly class="form_year form-control">            </div>        </div>    </div>    <div class="controls controls-row">        <div class="form-group">            <label class="col-sm-1 control-label no-padding-right" for="grossweight">                <span class="red">*</span>毛重:            </label>            <div class="col-sm-3">                <input type="text" name="grossweight" id="grossweight" class="form-control"                       data-bv-notempty th:value="${item.grossweight}" onchange="grossWeightChange()"                       placeholder="毛重"/>            </div>            <label class="col-sm-1 control-label no-padding-right" for="tareweight">                <span class="red">*</span>皮重:            </label>            <div class="col-sm-3">                <input type="text" name="tareweight" id="tareweight" class="form-control"                       data-bv-notempty th:value="${item.tareweight}" onchange="tareWeightChange()"                       placeholder="皮重"/>            </div>            <label class="col-sm-1 control-label no-padding-right" for="facqty">                <span class="red">*</span>实际数量:            </label>            <div class="col-sm-3">                <input type="text" name="facqty" id="facqty" class="form-control"                       data-bv-notempty th:value="${item.facqty}" onchange="facqtyChange()"/>            </div>        </div>    </div>    <div class="controls controls-row">        <div class="form-group">            <label class="col-sm-1 control-label no-padding-right" for="waterrate">                水分率:            </label>            <div class="col-sm-3">                <input type="text" name="waterrate" id="waterrate" class="form-control"                       th:value="${item.waterrate}"                       placeholder="水分率"/>            </div>            <label class="col-sm-1 control-label no-padding-right" for="waterdedurate">                水分扣率:            </label>            <div class="col-sm-3">                <input type="text" name="waterdedurate" id="waterdedurate" class="form-control"                       th:value="${item.waterdedurate}" onchange="waterdedurateChange()"                       placeholder="水分扣率"/>            </div>            <label class="col-sm-1 control-label no-padding-right" for="waterdeduqty">                水分扣量:            </label>            <div class="col-sm-3">                <input type="text" name="waterdeduqty" id="waterdeduqty" class="form-control"                       th:value="${item.waterdeduqty}"                       placeholder="水分扣量"/>            </div>        </div>    </div>    <div class="controls controls-row">        <div class="form-group">            <label class="col-sm-1 control-label no-padding-right" for="impurate">                杂质率:            </label>            <div class="col-sm-3">                <input type="text" name="impurate" id="impurate" class="form-control"                       th:value="${item.impurate}"                       placeholder="杂质率"/>            </div>            <label class="col-sm-1 control-label no-padding-right" for="impudedurate">                杂质扣率:            </label>            <div class="col-sm-3">                <input type="text" name="impudedurate" id="impudedurate" class="form-control"                       th:value="${item.impudedurate}" onchange="impudedurateChange()"                       placeholder="杂质扣率"/>            </div>            <label class="col-sm-1 control-label no-padding-right" for="impudeduqty">                杂质扣量:            </label>            <div class="col-sm-3">                <input type="text" name="impudeduqty" id="impudeduqty" class="form-control"                       th:value="${item.impudeduqty}"                       placeholder="杂质扣量"/>            </div>        </div>    </div>    <div class="controls controls-row">        <div class="form-group">            <label class="col-sm-1 control-label no-padding-right" for="allotqty">                结算数量:            </label>            <div class="col-sm-3">                <input type="text" name="allotqty" id="allotqty" class="form-control"                       th:value="${item.allotqty}"                       placeholder="结算数量"/>            </div>            <label class="col-sm-1 control-label no-padding-right" for="allotreason">                移库原因:            </label>            <div class="col-sm-3">                <input type="text" name="allotreason" id="allotreason" class="form-control"                       th:value="${item.allotreason}"                       placeholder="移库原因"/>            </div>        </div>    </div>    <div class="controls controls-row">        <div class="form-group">            <label class="col-sm-1 control-label no-padding-right" for="weightype">                称重类型:            </label>            <div class="col-sm-3">                <input type="text" name="weightype" id="weightype" class="form-control"                       th:value="${item.weightype}"                       placeholder="称重类型"/>            </div>            <label class="col-sm-1 control-label no-padding-right" for="packtype">                包装方式:            </label>            <div class="col-sm-3">                <select id="packtype" name="packtype" class="form-control"                        th:value="${item.packtype}">                </select>            </div>            <label class="col-sm-1 control-label no-padding-right" for="packageid">                包装物:            </label>            <div class="col-sm-3">                <select id="packageid" name="packageid" class="form-control"                        th:value="${item.packageid}">                </select>            </div>        </div>    </div>    <div class="controls controls-row">        <div class="form-group">            <label class="col-sm-1 control-label no-padding-right" for="packqty">                包装物数量:            </label>            <div class="col-sm-3">                <input type="text" name="packqty" id="packqty" class="form-control"                       th:value="${item.packqty}"                       placeholder="包装物数量"/>            </div>            <label class="col-sm-1 control-label no-padding-right" for="packunitwgt">                包装单件重量:            </label>            <div class="col-sm-3">                <input type="text" name="packunitwgt" id="packunitwgt" class="form-control"                       th:value="${item.packunitwgt}" onchange="packunitwgtChange()"                       placeholder="包装单件重量"/>            </div>            <label class="col-sm-1 control-label no-padding-right" for="packweight">                包装物总重量:            </label>            <div class="col-sm-3">                <input type="text" name="packweight" id="packweight" class="form-control"                       th:value="${item.packweight}"                       placeholder="包装物总重量"/>            </div>        </div>    </div>    <div class="controls controls-row">        <div class="form-group">            <label class="col-sm-1 control-label no-padding-right" for="remark">                备注:            </label>            <div class="col-sm-3">                <input type="text" name="remark" id="remark" class="form-control"                       th:value="${item.remark}"                       placeholder="备注"/>            </div>        </div>    </div>    </div>    <div class="form-group">        <div class="col-md-12 center">            <button class="btn btn-info" type="submit">                <i class="icon-ok bigger-110"></i>                保存            </button>            &nbsp; &nbsp; &nbsp;            <button class="btn" type="button" onclick="toBack()">                <i class="icon-arrow-left bigger-110"></i>                返回            </button>        </div>    </div></form></body></html><script th:inline="javascript">    var urlPrefix = "/graindepot-bussiness";    //var urlPrefix = "";    var g_id = [[${id}]];    var g_item = [[${item}]];    $(function () {        //初始化form验证        initForm();        //初始化日期时间框        $(".form_year").bootstrapYear();        //$(".form_datetime").bootstrapDatetime();        $(".form_date").bootstrapDate();        $('#grossweight').bootstrapNumber({precision: 2});        $('#tareweight').bootstrapNumber({precision: 2});        $('#facqty').bootstrapNumber({precision: 2});        $('#waterrate').bootstrapNumber({precision: 2, step: 0.01});        $('#waterdedurate').bootstrapNumber({precision: 2, step: 0.01});        $('#impurate').bootstrapNumber({precision: 2, step: 0.01});        $('#impudedurate').bootstrapNumber({precision: 2, step: 0.01});        $('#impudeduqty').bootstrapNumber({precision: 2});        $('#packqty').bootstrapNumber({precision: 2});        $('#packunitwgt').bootstrapNumber({precision: 2});        $('#packweight').bootstrapNumber({precision: 2});        $('#waterdeduqty').bootstrapNumber({precision: 2});        $('#allotqty').bootstrapNumber({precision: 2});        //初始化下拉框        //1.初始化移库类型        initBillKind();        //2.初始化包装物        initPackageid();        //3.初始化包装方式        initPacktype();        //4.初始化粮食品种下拉框        initGrainid();        //5.初始化粮食性质下拉框        initGrainattrid();        //6.初始化单据下拉框        initBillstate();        //7.初始化车船号下拉框        initTruckid();        //8.初始化粮仓        initStorageid();    });    //毛重/皮重改变计算实际数量（毛重-皮重）    function grossWeightChange() {        var a = $('#grossweight').val();        var b = $('#tareweight').val();        var fac = a - b;        // $('#facqty').val(fac);        // $("#facqty").trigger("change");        $('#facqty').bootstrapNumber("setValue",fac);    }    function tareWeightChange() {        var a = $('#grossweight').val();        var b = $('#tareweight').val();        var facqty = a - b;        // $('#facqty').val(facqty);        // $("#facqty").trigger("change");        $('#facqty').bootstrapNumber("setValue",facqty);    }    //实际数量改变计算水分/杂质扣量/结算数量    function facqtyChange() {        this.waterdedurateChange();        this.impudedurateChange();    }    //计算水分扣量    function waterdedurateChange() {        var a = $('#facqty').val();        var b = $('#waterdedurate').val();        var waterdeduqty = a * b;        // $('#waterdeduqty').val(waterdeduqty);        $('#waterdeduqty').bootstrapNumber("setValue",waterdeduqty);        this.impudedurateChange();    }    //计算杂质扣量    function impudedurateChange() {        var facqty = $('#facqty').val();        var impudedurate = $('#impudedurate').val();        var impudeduqty = facqty * impudedurate;        // $('#impudeduqty').val(impudeduqty);        $('#impudeduqty').bootstrapNumber("setValue",impudeduqty);        //计算结算数量（实际数量-水分扣量-杂质扣量）        var waterdeduqty = $('#waterdeduqty').val();//水分扣量        var allotqty = facqty - waterdeduqty - impudeduqty;        // $('#allotqty').val(allotqty);        $('#allotqty').bootstrapNumber("setValue",allotqty);        // console.log(facqty, waterdeduqty, impudeduqty, allotqty);    }    //计算包装物总重量(包装物数量*单件包装物重量)    function packunitwgtChange() {        var packqty = $('#packqty').val();        var packunitwgt = $('#packunitwgt').val();        var packweight = packqty * packunitwgt;        // $('#packweight').val(packweight);        $('#packweight').bootstrapNumber("setValue",packweight);    }    function initBillKind() {        var data = [{value: 1, text: "单据移库"}, {value: 2, text: "检斤移库"}];        $("#billkind").bootstrapSelect({            //url: '/tableListPost',            // type: 'POST',            data: data,            valueField: 'value',            textField: 'text',            defaultValue: g_item.billkind        });    }    function initPackageid() {        var data = [{value: 1, text: "编织袋"}, {value: 2, text: "麻袋"}, {value: 99, text: "其他"}];        $("#packageid").bootstrapSelect({            //url: '/tableListPost',            // type: 'POST',            data: data,            valueField: 'value',            textField: 'text',            defaultValue: g_item.packageid        });    }    function initPacktype() {        var data = [{value: 0, text: "散装"}, {value: 1, text: "包装"}];        $("#packtype").bootstrapSelect({            // url: '/graindepot-base/grain',            // type: 'GET',            data: data,            valueField: 'value',            textField: 'text',            defaultValue: g_item.packtype        });    }    function initBillstate() {        var data = [{value: 0, text: "编辑"}, {value: 1, text: "已审核"}, {value: -1, text: "已作废"}];        $("#billstate").bootstrapSelect({            // url: '/graindepot-base/grain',            // type: 'GET',            data: data,            valueField: 'value',            textField: 'text',            defaultValue: g_item.billstate        });    }    function initGrainid() {        $("#grainid").bootstrapSelect({            url: '/graindepot-base/selector/grainList',            type: 'GET',            valueField: 'grainid',            textField: 'grainname',            defaultValue: g_item.grainid,        });    }    function initGrainattrid() {        $("#grainattrid").bootstrapSelect({            url: '/graindepot-base/selector/grainattrList',            type: 'GET',            valueField: 'grainattrid',            textField: 'grainattrname',            defaultValue: g_item.grainattrid        });    }    function initTruckid() {        $("#truckid").bootstrapSelect({            url: '/graindepot-base/selector/trucknumList',            type: 'GET',            valueField: 'truckid',            textField: 'trucknum',            defaultValue: g_item.truckid        });    }    function initStorageid() {        $("#outstorageid").bootstrapSelect({            url: '/graindepot-base/selector/storageList',            type: 'GET',            valueField: 'storageid',            textField: 'storagename',            defaultValue: g_item.storageid        });        $("#instorageid").bootstrapSelect({            url: '/graindepot-base/selector/storageList',            type: 'GET',            valueField: 'storageid',            textField: 'storagename',            defaultValue: g_item.storageid        });    }    function toBack() {        parent.$.bootstrapBox.dialog.close();    }    //填写表单    function initForm() {        $('#validation-form').bootstrapValidator({            // fields: {            //     trucknum: {            //         validators: {            //             remote: {            //                 url: urlPrefix + '/truck/checkRepeat',            //                 message: '车船号已存在',//提示消息            //                 //delay :  2000,//每输入一个字符，就发ajax请求，服务器压力还是太大，设置2秒发送一次ajax（默认输入一个字符，提交一次，服务器压力太大）            //                 type: 'POST',//请求方式            //                 data: function (validator) {            //                     return {            //                         trucknum: $("#trucknum").val(),            //                         truckid: g_id            //                     };            //                 }            //             }            //         }            //     }            // }        }).on('success.form.bv', function (e) {            // Prevent form submission            e.preventDefault();            var param = turnArrayToJson($('form').serializeArray());            if (g_id) {                param.billid = g_id            }            $.post(urlPrefix + "/allot/edit", param, function (result) {                parent.toSave(result)            })        });    }</script>