<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head th:replace="head::head(${title})">
</head>
<link th:href="@{/assets/css/select/bootstrap-select.min.css}" rel="stylesheet" media="screen">
<script th:src="@{/assets/js/select/bootstrap-select.js}"></script>
<script th:src="@{/assets/js/select/defaults-zh_CN.js}"></script>
<link th:href="@{/assets/js/uploadify/uploadify.css}" rel="stylesheet" type="text/css">
<script th:src="@{/assets/js/uploadify/jquery.uploadify.js}"></script>


<body style="overflow-x: hidden">
<form class="form-horizontal" role="form" id="validation-form" method="get">

    <div class="form-group">
        <label class="col-sm-4 control-label no-padding-right" for="traderCode">
            往来单位编码:
        </label>

        <div class="col-sm-4">
            <input type="text" name="traderCode" id="traderCode" class="form-control"
                   th:value="${item.traderCode}"
                   placeholder="往来单位编码"/>
        </div>
    </div>

    <div class="form-group">
        <label class="col-sm-4 control-label no-padding-right" for="traderName">
            <span class="red">*</span>往来单位名称:
        </label>

        <div class="col-sm-4">
            <input type="text" name="traderName" id="traderName" class="form-control"
                   data-bv-notempty th:value="${item.traderName}"
                   placeholder="往来单位名称"/>
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-4 control-label no-padding-right" for="businessScope">
            <span class="red">*</span>业务范围:
        </label>

        <div class="col-sm-4">
            <input type="text" name="businessScope" id="businessScope" class="form-control"
                   data-bv-notempty th:value="${item.businessScope}"
                   placeholder="业务范围"/>
        </div>
    </div>




    <!--<div class="form-group">
        <label class="col-sm-4 control-label no-padding-right" for="provinceID">
            <span class="red">*</span>省: </label>

        <div class="col-sm-4">
            <select id="provinceID" name="provinceID" class="form-control"
                    data-bv-notempty th:value="${item.provinceID}">
            </select>
        </div>
    </div>

    <div class="form-group">
        <label class="col-sm-4 control-label no-padding-right" for="cityID">
            <span class="red">*</span>市: </label>

        <div class="col-sm-4">
            <select id="cityID" name="cityID" class="form-control"
                    data-bv-notempty th:value="${item.cityID}">
            </select>
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-4 control-label no-padding-right" for="countyID">
            <span class="red">*</span>县: </label>

        <div class="col-sm-4">
            <select id="countyID" name="countyID" class="form-control"
                    data-bv-notempty th:value="${item.countyID}">
            </select>
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-4 control-label no-padding-right" for="companyid">
            <span class="red">*</span>企业: </label>

        <div class="col-sm-4">
            <select id="companyid" name="companyid" class="form-control"
                    data-bv-notempty th:value="${item.companyid}">
            </select>
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-4 control-label no-padding-right" for="graindepotid">
            <span class="red">*</span>库点: </label>

        <div class="col-sm-4">
            <select id="graindepotid" name="graindepotid" class="form-control"
                    data-bv-notempty th:value="${item.graindepotid}">
            </select>
        </div>
    </div>-->

    <div class="form-group">
        <label class="col-sm-4 control-label no-padding-right" for="traderAddress">
            <span class="red">*</span>单位地址:
        </label>

        <div class="col-sm-4">
            <input type="text" name="traderAddress" id="traderAddress" class="form-control"
                   data-bv-notempty th:value="${item.traderAddress}"
                   placeholder="单位地址"/>
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-4 control-label no-padding-right" for="postalCode">
            邮政编码:
        </label>

        <div class="col-sm-4">
            <input type="text" name="postalCode" id="postalCode" class="form-control"
                   th:value="${item.postalCode}"
                   placeholder="邮政编码"/>
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-4 control-label no-padding-right" for="artificialPerson">
            法人代表:
        </label>

        <div class="col-sm-4">
            <input type="text" name="artificialPerson" id="artificialPerson" class="form-control"
                   th:value="${item.artificialPerson}"
                   placeholder="法人代表"/>
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-4 control-label no-padding-right" for="artificialIDCard">
            法人代表身份证:
        </label>

        <div class="col-sm-4">
            <input type="text" name="artificialIDCard" id="artificialIDCard" class="form-control"
                   th:value="${item.artificialIDCard}"
                   placeholder="法人代表身份证"/>
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-4 control-label no-padding-right" for="linkman">
            <span class="red">*</span>联系人:
        </label>

        <div class="col-sm-4">
            <input type="text" name="linkman" id="linkman" class="form-control"
                   data-bv-notempty th:value="${item.linkman}"
                   placeholder="联系人"/>
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-4 control-label no-padding-right" for="linkmanIDCard">
            联系人身份证号:
        </label>

        <div class="col-sm-4">
            <input type="text" name="linkmanIDCard" id="linkmanIDCard" class="form-control"
                   th:value="${item.linkmanIDCard}"
                   placeholder="联系人身份证号"/>
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-4 control-label no-padding-right" for="telNumber">
            <span class="red">*</span>联系电话:
        </label>

        <div class="col-sm-4">
            <input type="text" name="telNumber" id="telNumber" class="form-control"
                   data-bv-notempty th:value="${item.telNumber}"
                   placeholder="联系电话"/>
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-4 control-label no-padding-right" for="faxNumber">
            传真号码:
        </label>

        <div class="col-sm-4">
            <input type="text" name="faxNumber" id="faxNumber" class="form-control"
                   th:value="${item.faxNumber}"
                   placeholder="传真号码"/>
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-4 control-label no-padding-right" for="traderURL">
            单位网址:
        </label>

        <div class="col-sm-4">
            <input type="text" name="traderURL" id="traderURL" class="form-control"
                   th:value="${item.traderURL}"
                   placeholder="单位网址"/>
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-4 control-label no-padding-right" for="bankName">
            开户银行:
        </label>

        <div class="col-sm-4">
            <input type="text" name="bankName" id="bankName" class="form-control"
                   th:value="${item.bankName}"
                   placeholder="开户银行"/>
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-4 control-label no-padding-right" for="bankAccNo">
            银行账号:
        </label>

        <div class="col-sm-4">
            <input type="text" name="bankAccNo" id="bankAccNo" class="form-control"
                   th:value="${item.bankAccNo}"
                   placeholder="银行账号"/>
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-4 control-label no-padding-right" for="aRBala">
            应收余额:
        </label>

        <div class="col-sm-4">
            <input type="text" name="aRBala" id="aRBala" class="form-control"
                   th:value="${item.aRBala}"
                   placeholder="应收余额"/>
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-4 control-label no-padding-right" for="pRBala">
            预收余额:
        </label>

        <div class="col-sm-4">
            <input type="text" name="pRBala" id="pRBala" class="form-control"
                   th:value="${item.pRBala}"
                   placeholder="预收余额"/>
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-4 control-label no-padding-right" for="aPBala">
            应付余额:
        </label>

        <div class="col-sm-4">
            <input type="text" name="aPBala" id="aPBala" class="form-control"
                   th:value="${item.aPBala}"
                   placeholder="应付余额"/>
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-4 control-label no-padding-right" for="pPBala">
            预付余额:
        </label>

        <div class="col-sm-4">
            <input type="text" name="pPBala" id="pPBala" class="form-control"
                   th:value="${item.pPBala}"
                   placeholder="预付余额"/>
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-4 control-label no-padding-right" for="traderNature">
            单位性质:
        </label>

        <div class="col-sm-4">
            <select id="traderNature" name="traderNature" class="form-control"
                    th:value="${item.traderNature}">
            </select>
        </div>
    </div>

    <div class="form-group">
        <label class="col-sm-4 control-label no-padding-right" for="buyType">
            购进方式:
        </label>

        <div class="col-sm-4">
            <input type="text" name="buyType" id="buyType" class="form-control"
                   th:value="${item.buyType}"
                   placeholder="购进方式"/>
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-4 control-label no-padding-right" for="masterCardNum">
            主卡号:
        </label>

        <div class="col-sm-4">
            <input type="text" name="masterCardNum" id="masterCardNum" class="form-control"
                   th:value="${item.masterCardNum}"
                   placeholder="主卡号"/>
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-4 control-label no-padding-right" for="viceCardNum">
            副卡号:
        </label>

        <div class="col-sm-4">
            <input type="text" name="viceCardNum" id="viceCardNum" class="form-control"
                   th:value="${item.viceCardNum}"
                   placeholder="副卡号"/>
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-4 control-label no-padding-right" for="traderKind">
            往来单位种类:
        </label>

        <div class="col-sm-4">
            <input type="text" name="traderKind" id="traderKind" class="form-control"
                   th:value="${item.traderKind}"
                   placeholder="往来单位种类"/>
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-4 control-label no-padding-right" for="creditCode">
            统一社会信用代码:
        </label>

        <div class="col-sm-4">
            <input type="text" name="creditCode" id="creditCode" class="form-control"
                   th:value="${item.creditCode}"
                   placeholder="统一社会信用代码"/>
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-4 control-label no-padding-right" for="taxRegNo">
            单位税号:
        </label>

        <div class="col-sm-4">
            <input type="text" name="taxRegNo" id="taxRegNo" class="form-control"
                   th:value="${item.taxRegNo}"
                   placeholder="单位税号"/>
        </div>
    </div>

    <div class="form-group">
        <label class="col-sm-4 control-label no-padding-right" for="taxNature">
            纳税性质:
        </label>

        <div class="col-sm-4">
            <select id="taxNature" name="taxNature" class="form-control"
                    th:value="${item.taxNature}">
            </select>
        </div>
    </div>

    <div class="form-group">
        <label class="col-sm-4 control-label no-padding-right" for="businessRep">
            业务代表:
        </label>

        <div class="col-sm-4">
            <input type="text" name="businessRep" id="businessRep" class="form-control"
                   th:value="${item.businessRep}"
                   placeholder="业务代表"/>
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-4 control-label no-padding-right" for="remark"> 备注: </label>

        <div class="col-sm-4">
            <textarea class="form-control" rows="3" name="remark" id="remark"
                      th:text="${item.remark}"></textarea>
        </div>
    </div>

    <div class="form-group">
        <div class="col-md-6 center">
            <button class="btn btn-info" type="submit">
                <i class="icon-ok bigger-110"></i>
                保存
            </button>
            &nbsp; &nbsp; &nbsp;
            <button class="btn" type="button" onclick="toBack()">
                <i class="icon-arrow-left bigger-110"></i>
                返回
            </button>
        </div>
    </div>

</form>

</body>
</html>
<script th:inline="javascript">
    //var urlPrefix="/graindepot-bussiness";
    var urlPrefix = "";
    var g_id = [[${id}]];
    var g_item = [[${item}]];
    $(function () {
        //初始化form验证
        initForm();
        //初始化下拉框
        //1.初始单位性质
        initTraderNature();
        //2.初始化纳税人性质
        initTaxNature();
    });

    function initTraderNature() {
        //单位性质（1：国有企业 2：民营企业3：其他内资企业 4：港澳台商投资企业 5：外商投资企业: 6：事业单位 99：其他）
        var data = [{value: 1, text: "国有企业"}, {value: 2, text: "民营企业"}
            ,{value: 3, text: "其他内资企业"}, {value: 4, text: "港澳台商投资企业"}
            ,{value: 5, text: "外商投资企业"}, {value: 6, text: "事业单位"}, {value: 99, text: "其他"}];
        $("#traderNature").bootstrapSelect({
            data: data,
            valueField: 'value',
            textField: 'text',
            defaultValue: g_item.traderNature
        });
    }
    function initTaxNature() {
        //纳税性质(1：小规模纳税人，2：一般纳税人)
        var data = [{value: 1, text: "小规模纳税人"}, {value: 2, text: "一般纳税人"}];
        $("#taxNature").bootstrapSelect({
            data: data,
            valueField: 'value',
            textField: 'text',
            defaultValue: g_item.taxNature
        });
    }

    function toBack() {
        parent.$.bootstrapBox.dialog.close();
    }

    //初始化form表单验证和提交
    function initForm(){
        $('#validation-form').bootstrapValidator({
            fields: {
                traderName: {
                    validators: {
                        remote: {
                            url: urlPrefix + '/trader/checkRepeat',
                            message: '往来单位名称已存在',//提示消息
                            //delay :  2000,//每输入一个字符，就发ajax请求，服务器压力还是太大，设置2秒发送一次ajax（默认输入一个字符，提交一次，服务器压力太大）
                            type: 'POST',//请求方式
                            data: function (validator) {
                                return {
                                    traderName: $("#traderName").val(),
                                    traderID: g_id
                                };
                            }
                        }
                    }
                }
            }
        }).on('success.form.bv', function(e) {
            // Prevent form submission
            e.preventDefault();
            var param = turnArrayToJson($('form').serializeArray());
            if (g_id) {
                param.traderID = g_id
            }
            $.post(urlPrefix + "/trader/edit", param, function (result) {
                parent.toSave(result)
            })
        });
    }


    function toSave() {
        $("#validation-form").bootstrapValidator('validate');//提交验证
        if ($("#validation-form").data('bootstrapValidator').isValid()) {//获取验证结果，如果成功，执行下面代码
            var param = turnArrayToJson($('form').serializeArray());
            if (g_id) {
                param.traderID = g_id
            }
            $.post(urlPrefix + "/trader/edit", param, function (result) {
                parent.toSave(result)
            })
        }
    }

</script>